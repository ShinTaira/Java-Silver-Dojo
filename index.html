<!DOCTYPE html>
<html lang="ja" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Java Silver å®Œå…¨æ”»ç•¥é“å ´ (Ver 17.1)</title>
    <!-- Favicon: Java-like Coffee Cup -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M25,55 C25,80 45,90 65,90 H75 V80 H65 C50,80 35,75 35,55 V45 H25 Z' fill='%235382a1'/><path d='M25,45 H75 V55 C75,70 70,75 65,75 H35 C30,75 25,70 25,55 Z' fill='%235382a1'/><path d='M75,45 H85 C90,45 90,55 85,60 H75 Z' fill='%235382a1'/><path d='M40,30 Q50,10 60,30 T80,30' fill='none' stroke='%23f89820' stroke-width='6' stroke-linecap='round'/><path d='M30,20 Q40,0 50,20 T70,20' fill='none' stroke='%23f89820' stroke-width='6' stroke-linecap='round'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkbg: '#0f172a',
                        darkcard: '#1e293b',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .drill-card {
            transition: all 0.2s ease;
            border-bottom: 4px solid transparent;
        }

        .drill-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .option-selected {
            background-color: #eff6ff !important;
            border-color: #3b82f6 !important;
            color: #1d4ed8 !important;
            box-shadow: 0 0 0 2px #3b82f6 inset !important;
        }

        .dark .option-selected {
            background-color: #1e3a8a !important;
            border-color: #60a5fa !important;
            color: #bfdbfe !important;
        }

        .loader {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .coding-textarea {
            background-color: #1e1e1e;
            color: #d4d4d4;
            caret-color: white;
            font-family: 'Consolas', monospace;
            line-height: 1.5;
        }

        /* Exam Toggle Styles */
        .exam-toggle-btn {
            transition: all 0.2s ease;
        }

        .exam-toggle-active {
            background-color: white;
            color: #4f46e5;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .dark .exam-toggle-active {
            background-color: #334155;
            color: white;
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden text-slate-800 bg-[#f8fafc] dark:bg-darkbg dark:text-slate-200">

    <!-- Global Error Display -->
    <div id="global-error-display"
        class="hidden fixed bottom-0 left-0 w-full bg-red-500 text-white p-2 text-center text-xs z-[9999]"></div>

    <!-- Navbar -->
    <header
        class="bg-white dark:bg-darkcard border-b border-slate-200 dark:border-slate-700 z-50 shrink-0 transition-colors">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <!-- Java Icon (Maintained) -->
                    <div class="w-10 h-10 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-10 h-10 drop-shadow-md">
                            <path d="M25,55 C25,80 45,90 65,90 H75 V80 H65 C50,80 35,75 35,55 V45 H25 Z"
                                fill="#5382a1" />
                            <path d="M25,45 H75 V55 C75,70 70,75 65,75 H35 C30,75 25,70 25,55 Z" fill="#5382a1" />
                            <path d="M75,45 H85 C90,45 90,55 85,60 H75 Z" fill="#5382a1" />
                            <path d="M40,30 Q50,10 60,30 T80,30" fill="none" stroke="#f89820" stroke-width="6"
                                stroke-linecap="round" />
                            <path d="M30,20 Q40,0 50,20 T70,20" fill="none" stroke="#f89820" stroke-width="6"
                                stroke-linecap="round" />
                        </svg>
                    </div>
                    <div class="mr-4">
                        <h1 id="app-main-title" class="font-bold text-xl tracking-tight text-slate-900 dark:text-white">
                            Java Silver é“å ´</h1>
                        <p id="app-main-ver" class="text-[10px] text-slate-500 dark:text-slate-400 leading-none">Ver
                            17.1 Official Chapters</p>
                    </div>

                    <!-- Exam Switching Toggle (New Feature) -->
                    <div
                        class="hidden sm:flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl items-center border border-slate-200 dark:border-slate-700">
                        <button onclick="app.switchExam('silver')" id="toggle-silver"
                            class="exam-toggle-btn px-4 py-1.5 text-xs font-bold rounded-lg exam-toggle-active">Silver</button>
                        <button onclick="app.switchExam('gold')" id="toggle-gold"
                            class="exam-toggle-btn px-4 py-1.5 text-xs font-bold rounded-lg text-slate-500">Gold</button>
                    </div>
                </div>

                <div class="flex items-center gap-1 sm:gap-2">
                    <nav class="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg overflow-x-auto">
                        <button onclick="app.switchTab('dashboard')" id="nav-dashboard"
                            class="nav-item px-3 py-1.5 text-sm font-medium rounded-md transition whitespace-nowrap text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">ãƒ›ãƒ¼ãƒ </button>
                        <button onclick="app.switchTab('create')" id="nav-create"
                            class="nav-item px-3 py-1.5 text-sm font-medium rounded-md transition whitespace-nowrap text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">ä½œæˆ</button>
                        <button onclick="app.switchTab('coding')" id="nav-coding"
                            class="nav-item px-3 py-1.5 text-sm font-medium rounded-md transition whitespace-nowrap text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">ğŸ’»
                            å®Ÿè·µ</button>
                        <button onclick="app.switchTab('history')" id="nav-history"
                            class="nav-item px-3 py-1.5 text-sm font-medium rounded-md transition whitespace-nowrap text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">è¨˜éŒ²</button>
                        <button onclick="app.switchTab('ai')" id="nav-ai"
                            class="nav-item px-3 py-1.5 text-sm font-medium rounded-md transition whitespace-nowrap text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">AIå…ˆç”Ÿ</button>
                        <button onclick="app.switchTab('settings')" id="nav-settings"
                            class="nav-item px-3 py-1.5 text-sm font-medium rounded-md transition whitespace-nowrap text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white">è¨­å®š</button>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-hidden relative">

        <!-- DASHBOARD -->
        <div id="tab-dashboard" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 fade-in">
            <div class="max-w-5xl mx-auto">

                <!-- Exam Mode Badge -->
                <div id="exam-mode-badge"
                    class="mb-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200">
                    Java SE 11 Silver Mode
                </div>

                <!-- Status Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div
                        class="bg-white dark:bg-darkcard p-5 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm text-center md:text-left">
                        <div class="text-xs text-slate-400 font-bold uppercase">ç™»éŒ²å•é¡Œæ•°</div>
                        <div class="text-3xl font-bold text-slate-800 dark:text-white mt-1" id="stat-total">0</div>
                    </div>
                    <div
                        class="bg-white dark:bg-darkcard p-5 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm text-center md:text-left">
                        <div class="text-xs text-slate-400 font-bold uppercase">æ­£è§£ç‡</div>
                        <div class="text-3xl font-bold text-emerald-500 mt-1" id="stat-rate">0%</div>
                    </div>
                    <div
                        class="bg-white dark:bg-darkcard p-5 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm col-span-2 flex items-center justify-between bg-gradient-to-r from-white to-slate-50 dark:from-darkcard dark:to-slate-800 px-6">
                        <div>
                            <div class="text-xs text-slate-400 font-bold uppercase">è‹¦æ‰‹ãªå•é¡Œ</div>
                            <div class="text-3xl font-bold text-red-500 mt-1"><span id="wrong-count">0</span> <span
                                    class="text-base text-slate-400 font-normal">å•</span></div>
                        </div>
                        <button onclick="app.startQuiz('review')" id="btn-review"
                            class="px-6 py-2.5 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 font-bold rounded-lg hover:bg-red-100 dark:hover:bg-red-900/50 transition disabled:opacity-50">å¾©ç¿’ã™ã‚‹</button>
                    </div>
                </div>

                <!-- Level Based Quizzes -->
                <div class="mb-8">
                    <h3 class="text-base font-bold text-slate-700 dark:text-slate-200 mb-3 flex items-center gap-2">
                        <span class="text-xl">ğŸ“Š</span> ãƒ¬ãƒ™ãƒ«åˆ¥æ¼”ç¿’ (å„30å•)
                    </h3>
                    <div class="grid grid-cols-3 gap-4">
                        <button onclick="app.startQuiz('level-1')"
                            class="bg-gradient-to-br from-emerald-400 to-teal-500 text-white p-4 rounded-xl shadow-lg hover:scale-[1.02] transition relative overflow-hidden group text-left">
                            <div
                                class="absolute right-0 top-0 p-3 text-4xl opacity-20 group-hover:scale-125 transition">
                                ğŸ£</div>
                            <div class="font-bold text-lg">åˆç´š</div>
                            <div class="text-xs opacity-90 mt-1" id="level-desc-1">åŸºæœ¬ãƒ»å¤‰æ•°ãƒ»æ¼”ç®—å­</div>
                        </button>
                        <button onclick="app.startQuiz('level-2')"
                            class="bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-xl shadow-lg hover:scale-[1.02] transition relative overflow-hidden group text-left">
                            <div
                                class="absolute right-0 top-0 p-3 text-4xl opacity-20 group-hover:scale-125 transition">
                                ğŸ¦…</div>
                            <div class="font-bold text-lg">ä¸­ç´š</div>
                            <div class="text-xs opacity-90 mt-1" id="level-desc-2">OOPãƒ»é…åˆ—ãƒ»API</div>
                        </button>
                        <button onclick="app.startQuiz('level-3')"
                            class="bg-gradient-to-br from-violet-600 to-fuchsia-600 text-white p-4 rounded-xl shadow-lg hover:scale-[1.02] transition relative overflow-hidden group text-left">
                            <div
                                class="absolute right-0 top-0 p-3 text-4xl opacity-20 group-hover:scale-125 transition">
                                ğŸ”¥</div>
                            <div class="font-bold text-lg">ä¸Šç´š</div>
                            <div class="text-xs opacity-90 mt-1" id="level-desc-3">ä¾‹å¤–ãƒ»ãƒ©ãƒ ãƒ€ãƒ»ç¶™æ‰¿</div>
                        </button>
                    </div>
                </div>

                <!-- Search & Bookmarks -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div
                        class="bg-white dark:bg-darkcard p-6 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm">
                        <h3 class="text-base font-bold text-slate-700 dark:text-slate-200 mb-3 flex items-center gap-2">
                            <span class="text-xl">ğŸ”</span> ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¼”ç¿’
                        </h3>
                        <div class="flex gap-2">
                            <input type="text" id="search-input"
                                class="flex-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg px-4 py-2.5 text-sm outline-none focus:ring-2 focus:ring-indigo-500 transition dark:text-white"
                                placeholder="ä¾‹: ãƒ©ãƒ ãƒ€, ä¾‹å¤–, ç¶™æ‰¿...">
                            <button onclick="app.startSearchQuiz()"
                                class="bg-slate-800 dark:bg-slate-700 text-white px-5 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-700 dark:hover:bg-slate-600 transition">æ¤œç´¢</button>
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-darkcard p-6 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center justify-between">
                        <div>
                            <h3
                                class="text-base font-bold text-slate-700 dark:text-slate-200 mb-1 flex items-center gap-2">
                                <span class="text-xl">ğŸ”–</span> ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯
                            </h3>
                            <p class="text-xs text-slate-400">ä¿å­˜æ¸ˆã¿: <span id="bookmark-count"
                                    class="font-bold text-slate-700 dark:text-slate-300">0</span> å•</p>
                        </div>
                        <button onclick="app.startQuiz('bookmark')" id="btn-bookmark"
                            class="px-6 py-2.5 bg-yellow-50 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 font-bold rounded-lg hover:bg-yellow-100 dark:hover:bg-yellow-900/50 transition disabled:opacity-50">è§£ã</button>
                    </div>
                </div>

                <!-- Chapters Grid -->
                <div class="mb-12">
                    <h3 id="chapter-grid-title" class="text-lg font-bold text-slate-700 dark:text-slate-200 mb-4">ğŸ“–
                        ç« ã”ã¨ã®ç·´ç¿’ (Java Silver å…¬å¼æº–æ‹ )</h3>
                    <div id="chapter-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
                        <!-- Dynamic -->
                    </div>
                </div>

                <!-- IMPORT SECTION -->
                <div
                    class="bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800 rounded-xl p-6 mb-8 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div>
                        <h3 class="text-base font-bold text-indigo-800 dark:text-indigo-300 flex items-center gap-2">ğŸ“¥
                            ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</h3>
                        <p class="text-xs text-indigo-600 dark:text-indigo-400 mt-1">
                            å•é¡ŒãŒãªã„å ´åˆã¯ã“ã“ã‹ã‚‰JSONã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <label
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold hover:bg-indigo-700 transition cursor-pointer shadow-md">
                            JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                            <input type="file" class="hidden" multiple onchange="dataManager.importData(this)">
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- CREATE TAB -->
        <div id="tab-create" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 hidden fade-in">
            <div class="max-w-3xl mx-auto space-y-6">
                <div
                    class="bg-white dark:bg-darkcard rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                    <div class="border-b border-slate-100 dark:border-slate-700 p-5 bg-slate-50 dark:bg-slate-800">
                        <h2 class="text-lg font-bold text-slate-700 dark:text-slate-200">ğŸ“ å•é¡Œã‚’ä½œæˆ</h2>
                    </div>
                    <form id="create-form" onsubmit="creator.saveQuestion(event)" class="p-6 space-y-6">
                        <input type="hidden" id="edit-id" value="">
                        <div>
                            <label
                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">ã‚«ãƒ†ã‚´ãƒª(ç« )</label>
                            <select id="create-chapter"
                                class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg px-4 py-3 text-sm outline-none dark:text-white"></select>
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">å•é¡Œæ–‡</label>
                            <textarea id="create-text" rows="3"
                                class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition dark:text-white"
                                required placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›..."></textarea>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Javaã‚³ãƒ¼ãƒ‰
                                (ä»»æ„)</label>
                            <textarea id="create-code" rows="4"
                                class="w-full bg-slate-900 text-slate-200 font-mono text-sm rounded-lg p-3 border border-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none transition"
                                placeholder="public class Main { ... }"></textarea>
                        </div>
                        <div
                            class="bg-slate-50 dark:bg-slate-800 p-4 rounded-lg border border-slate-100 dark:border-slate-700">
                            <div class="flex justify-between items-center mb-3">
                                <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider">é¸æŠè‚¢ &
                                    æ­£è§£</label>
                                <button type="button" onclick="creator.addOption()"
                                    class="text-xs bg-indigo-600 text-white px-3 py-1 rounded font-bold shadow-sm">ï¼‹
                                    è¿½åŠ </button>
                            </div>
                            <div id="options-container" class="space-y-3"></div>
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">è§£èª¬</label>
                            <textarea id="create-explanation" rows="4"
                                class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition dark:text-white"
                                required placeholder="è§£èª¬ã‚’å…¥åŠ›..."></textarea>
                        </div>
                        <div class="pt-4 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                            <button type="button" onclick="creator.cancelEdit()" id="btn-cancel-edit"
                                class="hidden text-sm text-slate-500 hover:text-slate-800 px-4 py-2">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            <button type="submit" id="btn-save-question"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg">è¿½åŠ ã™ã‚‹</button>
                        </div>
                    </form>
                </div>
                <div id="user-questions-list" class="space-y-2"></div>
            </div>
        </div>

        <!-- SETTINGS, AI, HISTORY, QUIZ VIEW etc. (Kept same structure) -->
        <div id="tab-coding" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 hidden fade-in">
            <div class="max-w-5xl mx-auto h-full flex flex-col">
                <div id="coding-menu" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8"></div>
                <div id="coding-workspace" class="hidden flex-1 flex flex-col md:flex-row gap-4 h-full min-h-[500px]">
                    <div class="md:w-1/3 flex flex-col gap-4">
                        <div
                            class="bg-white dark:bg-darkcard p-5 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex-1">
                            <button onclick="codingApp.close()" class="mb-4 text-xs font-bold flex items-center gap-1">â†
                                æˆ»ã‚‹</button>
                            <h3 class="text-lg font-bold text-slate-800 dark:text-white mt-2 mb-4" id="coding-title">å•é¡Œ
                            </h3>
                            <div class="text-sm text-slate-600 dark:text-slate-300 whitespace-pre-wrap"
                                id="coding-desc"></div>
                        </div>
                    </div>
                    <div class="md:w-2/3 flex flex-col gap-4">
                        <textarea id="coding-editor"
                            class="coding-textarea flex-1 p-4 w-full h-full resize-none outline-none text-sm rounded-xl"
                            spellcheck="false"></textarea>
                        <button onclick="codingApp.check()"
                            class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg">åˆ¤å®šã™ã‚‹ â–¶</button>
                        <div id="coding-result"
                            class="hidden bg-white dark:bg-darkcard p-4 rounded-xl border border-slate-200 dark:border-slate-700">
                            <h4 id="coding-result-title" class="font-bold"></h4>
                            <p id="coding-result-msg" class="text-sm mb-4"></p>
                            <pre
                                class="bg-slate-900 text-slate-200 p-2 rounded text-xs"><code id="coding-answer-code"></code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI TAB -->
        <div id="tab-ai" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 hidden fade-in">
            <div class="max-w-3xl mx-auto space-y-6">
                <div
                    class="bg-white dark:bg-darkcard p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <h2 class="text-base font-bold mb-4">ğŸ”‘ Gemini API è¨­å®š</h2>
                    <input type="password" id="api-key-input"
                        class="w-full bg-slate-50 dark:bg-slate-800 border rounded-lg px-4 py-2 text-sm outline-none mb-4 dark:text-white"
                        placeholder="AIzaSy...">
                    <button onclick="aiTutor.saveKey()"
                        class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold">ä¿å­˜</button>
                </div>
                <div class="bg-gradient-to-br from-indigo-600 to-violet-600 p-8 rounded-2xl shadow-lg text-white">
                    <h2 class="text-2xl font-bold mb-1">AI å…ˆç”Ÿã®å­¦ç¿’åˆ†æ</h2>
                    <button onclick="aiTutor.getAdvice()" id="btn-get-advice"
                        class="w-full bg-white text-indigo-600 font-bold py-4 rounded-xl shadow-lg mt-6" disabled>ğŸ§ 
                        åˆ†æï¼†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã‚‚ã‚‰ã†</button>
                </div>
                <div id="ai-output-box" class="hidden bg-white dark:bg-darkcard p-6 rounded-xl shadow-sm border">
                    <div id="ai-response-content" class="text-sm ai-response whitespace-pre-wrap"></div>
                </div>
            </div>
        </div>

        <!-- HISTORY TAB -->
        <div id="tab-history" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 hidden fade-in">
            <div class="max-w-6xl mx-auto">
                <div class="grid md:grid-cols-12 gap-6">
                    <div class="md:col-span-8 space-y-6">
                        <div class="bg-white dark:bg-darkcard p-4 rounded-xl shadow-sm border h-64 md:h-80">
                            <canvas id="historyChart"></canvas>
                        </div>
                        <div id="history-list" class="space-y-3"></div>
                    </div>
                    <div class="md:col-span-4" id="weakness-advice-list"></div>
                </div>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div id="tab-settings" class="absolute inset-0 overflow-y-auto p-4 sm:p-8 hidden fade-in">
            <div class="max-w-2xl mx-auto space-y-8 text-center">
                <button onclick="app.toggleTheme()"
                    class="px-6 py-3 bg-slate-200 dark:bg-slate-700 rounded-lg font-bold">ğŸŒ™ ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ</button>
                <div class="mt-8 space-y-4">
                    <button onclick="dataManager.exportData()"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold">ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜(JSON)</button>
                    <button onclick="dataManager.resetAll()" class="text-red-500 underline text-sm block mx-auto">ğŸ—‘
                        å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                </div>
            </div>
        </div>

        <!-- QUIZ VIEW -->
        <div id="tab-quiz-view" class="absolute inset-0 overflow-y-auto p-4 bg-[#f8fafc] dark:bg-darkbg hidden z-50">
            <div class="max-w-3xl mx-auto pb-20 fade-in mt-4">
                <div class="flex justify-between items-center mb-6">
                    <button onclick="app.quitQuiz()" class="text-xs font-bold flex items-center gap-1">â† ä¸­æ–­ã—ã¦æˆ»ã‚‹</button>
                    <div id="mode-display" class="text-xs bg-white dark:bg-darkcard px-3 py-1 rounded-full border">
                        Random</div>
                </div>
                <div class="bg-white dark:bg-darkcard p-6 md:p-10 rounded-2xl shadow-xl border mb-8 relative">
                    <div class="absolute top-0 left-0 w-full h-1.5 bg-slate-100 dark:bg-slate-800">
                        <div id="quiz-progress" class="h-full bg-indigo-500 transition-all duration-300"
                            style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between mt-4 mb-4">
                        <span id="q-category"
                            class="bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 px-3 py-1 rounded text-xs font-bold">Chapter</span>
                        <div class="font-mono text-slate-300 font-bold text-xl"><span id="q-current"
                                class="text-slate-800 dark:text-white">1</span>/<span id="q-total">10</span></div>
                    </div>
                    <h3 id="q-text"
                        class="text-lg md:text-xl font-bold text-slate-800 dark:text-slate-100 mb-6 whitespace-pre-wrap">
                    </h3>
                    <div id="code-container" class="bg-[#1e1e1e] rounded-lg overflow-hidden mb-6 hidden">
                        <pre class="!p-5 text-sm"><code class="language-java" id="code-content"></code></pre>
                    </div>
                </div>
                <div id="options-list" class="grid gap-3 mb-10"></div>
                <div id="explanation-box"
                    class="hidden bg-white dark:bg-darkcard border rounded-2xl p-6 shadow-lg fade-in mb-8">
                    <div id="result-badge" class="font-bold text-xl mb-4"></div>
                    <div id="explanation-text" class="text-sm whitespace-pre-wrap mb-4"></div>
                    <button onclick="app.nextQuestion()"
                        class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl">æ¬¡ã®å•é¡Œã¸ (Enter)</button>
                </div>
            </div>
        </div>

        <!-- SESSION RESULT -->
        <div id="session-result"
            class="fixed inset-0 bg-slate-900/90 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
            <div
                class="bg-white dark:bg-darkcard rounded-2xl shadow-2xl max-w-sm w-full p-8 text-center space-y-6 fade-in">
                <div class="text-6xl">ğŸ‰</div>
                <h3 class="text-2xl font-bold">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h3>
                <div class="grid grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-800 p-5 rounded-xl border">
                    <div>
                        <div class="text-[10px] uppercase font-bold">æ­£è§£æ•°</div>
                        <div class="text-3xl font-bold text-indigo-600" id="res-score">0</div>
                    </div>
                    <div>
                        <div class="text-[10px] uppercase font-bold">æ­£è§£ç‡</div>
                        <div class="text-3xl font-bold" id="res-rate">0%</div>
                    </div>
                </div>
                <button onclick="app.closeSessionResult()"
                    class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl">OK</button>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script>
        // Global Error Handler
        window.onerror = (msg, src, line) => {
            const e = document.getElementById('global-error-display');
            e.classList.remove('hidden');
            e.innerText = `Error: ${msg} @ ${line}`;
        };

        const STORAGE_KEY = 'javaSilverGoldDojo_GlobalData';

        // Chapter Definitions
        const CHAPTER_MAPS = {
            silver: {
                1: "ç°¡å˜ãªJavaãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä½œæˆ", 2: "Javaã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å‹ã¨æ–‡å­—åˆ—æ“ä½œ", 3: "æ¼”ç®—å­ã¨åˆ¤å®šæ§‹é€ ",
                4: "åˆ¶å¾¡æ§‹é€ ", 5: "é…åˆ—ã®æ“ä½œ", 6: "ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ãƒ¡ã‚½ãƒƒãƒ‰",
                7: "ã‚¯ãƒ©ã‚¹ã®ç¶™æ‰¿ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã€æŠ½è±¡ã‚¯ãƒ©ã‚¹", 8: "é–¢æ•°å‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã€ãƒ©ãƒ ãƒ€å¼",
                9: "API", 10: "ä¾‹å¤–å‡¦ç†", 11: "ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ "
            },
            gold: {
                1: "Javaã®åŸºç¤(é–¢æ•°å‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç­‰)", 2: "ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã¨ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³", 3: "é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°(Stream)",
                4: "ä¾‹å¤–å‡¦ç†ã¨ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³", 5: "Javaã®I/O(NIO2)", 6: "JDBCã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š",
                7: "ä¸¦åˆ—å‡¦ç†(Concurrency)", 8: "ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ", 9: "ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ (è©³ç´°)",
                10: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£", 11: "APIã®æ´»ç”¨(Optionalç­‰)"
            }
        };

        var app = {
            data: {
                questions: [],
                results: {},
                history: [],
                bookmarks: [],
                theme: 'light',
                examMode: 'silver' // Default
            },
            state: { queue: [], currentIdx: 0, sessionStats: { correct: 0, wrongInfo: [] }, modeName: '', isQuizActive: false },

            init: function () {
                this.loadData();
                this.applyTheme();
                this.switchTab('dashboard');
                this.updateExamUI();
            },

            // --- EXAM MODE LOGIC ---
            switchExam: function (mode) {
                this.data.examMode = mode;
                this.updateExamUI();
                this.save();
                this.renderChapters();
                this.updateDashboard();
            },

            updateExamUI: function () {
                const isGold = this.data.examMode === 'gold';
                const mainTitle = isGold ? "Java Gold é“å ´" : "Java Silver é“å ´";
                const version = isGold ? "Ver 11.0 / 17.0 Professional" : "Ver 17.1 Official Chapters";
                const badge = isGold ? "Java SE 11 Gold Mode" : "Java SE 11 Silver Mode";

                document.getElementById('app-main-title').innerText = mainTitle;
                document.getElementById('app-main-ver').innerText = version;
                document.getElementById('page-title').innerText = mainTitle + " å®Œå…¨æ”»ç•¥";

                const badgeEl = document.getElementById('exam-mode-badge');
                badgeEl.innerText = badge;
                badgeEl.className = isGold
                    ? "mb-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200"
                    : "mb-4 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-indigo-100 text-indigo-800 dark:bg-indigo-900/40 dark:text-indigo-200";

                // Update Level Descriptions
                if (isGold) {
                    document.getElementById('level-desc-1').innerText = "ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ãƒ»ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³";
                    document.getElementById('level-desc-2').innerText = "Stream APIãƒ»å…¥å‡ºåŠ›";
                    document.getElementById('level-desc-3').innerText = "ä¸¦åˆ—å‡¦ç†ãƒ»JDBCãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£";
                    document.getElementById('chapter-grid-title').innerText = "ğŸ“– ç« ã”ã¨ã®ç·´ç¿’ (Java Gold æº–æ‹ )";
                } else {
                    document.getElementById('level-desc-1').innerText = "åŸºæœ¬ãƒ»å¤‰æ•°ãƒ»æ¼”ç®—å­";
                    document.getElementById('level-desc-2').innerText = "OOPãƒ»é…åˆ—ãƒ»API";
                    document.getElementById('level-desc-3').innerText = "ä¾‹å¤–ãƒ»ãƒ©ãƒ ãƒ€ãƒ»ç¶™æ‰¿";
                    document.getElementById('chapter-grid-title').innerText = "ğŸ“– ç« ã”ã¨ã®ç·´ç¿’ (Java Silver å…¬å¼æº–æ‹ )";
                }

                // Toggle Button Styling
                const sBtn = document.getElementById('toggle-silver');
                const gBtn = document.getElementById('toggle-gold');
                if (isGold) {
                    gBtn.className = "exam-toggle-btn px-4 py-1.5 text-xs font-bold rounded-lg exam-toggle-active";
                    sBtn.className = "exam-toggle-btn px-4 py-1.5 text-xs font-bold rounded-lg text-slate-500";
                } else {
                    sBtn.className = "exam-toggle-btn px-4 py-1.5 text-xs font-bold rounded-lg exam-toggle-active";
                    gBtn.className = "exam-toggle-btn px-4 py-1.5 text-xs font-bold rounded-lg text-slate-500";
                }
            },

            // --- CORE APP LOGIC (Maintained) ---
            loadData: function () {
                try {
                    const saved = localStorage.getItem(STORAGE_KEY);
                    if (saved) this.data = { ...this.data, ...JSON.parse(saved) };
                    this.updateDashboard();
                } catch (e) { console.error("Load failed", e); }
            },
            save: function () { localStorage.setItem(STORAGE_KEY, JSON.stringify(this.data)); },

            switchTab: function (tab) {
                ['dashboard', 'ai', 'history', 'create', 'quiz-view', 'settings', 'coding'].forEach(id => {
                    const el = document.getElementById('tab-' + id);
                    if (el) el.classList.add('hidden');
                });
                document.getElementById('tab-' + tab).classList.remove('hidden');
                if (tab === 'dashboard') this.renderChapters();
                if (tab === 'history') this.renderHistory();
            },

            renderChapters: function () {
                const grid = document.getElementById('chapter-grid');
                grid.innerHTML = '';
                const map = CHAPTER_MAPS[this.data.examMode];

                Object.keys(map).forEach(num => {
                    const btn = document.createElement('button');
                    btn.className = `drill-card bg-white dark:bg-darkcard p-4 rounded-xl border border-slate-200 dark:border-slate-700 text-left h-32 flex flex-col justify-between`;
                    btn.onclick = () => this.startQuiz('chapter', num);

                    // Simple count logic based on ID starting with mode (e.g. gold-ch1)
                    // Or filtering from category string
                    const chapterName = map[num];
                    btn.innerHTML = `<div class="font-bold text-slate-700 dark:text-slate-200 text-sm line-clamp-2">ç¬¬${num}ç«  ${chapterName}</div><div class="text-xs text-slate-400">æ¼”ç¿’ã‚’é–‹å§‹ã™ã‚‹ â†’</div>`;
                    grid.appendChild(btn);
                });
            },

            startQuiz: function (mode, param) {
                let list = [];
                if (mode === 'chapter') {
                    const targetName = CHAPTER_MAPS[this.data.examMode][param];
                    list = this.data.questions.filter(q => q.category.includes(targetName));
                } else if (mode === 'review') {
                    list = this.data.questions.filter(q => this.data.results[q.id] === false);
                } else if (mode === 'bookmark') {
                    list = this.data.questions.filter(q => this.data.bookmarks.includes(q.id));
                } else {
                    list = [...this.data.questions].sort(() => Math.random() - 0.5).slice(0, 10);
                }

                if (list.length === 0) return alert('å•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                this.state.queue = list;
                this.state.currentIdx = 0;
                this.state.sessionStats = { correct: 0, wrongInfo: [] };
                this.state.isQuizActive = true;
                this.switchTab('quiz-view');
                this.renderQuestion();
            },

            renderQuestion: function () {
                const q = this.state.queue[this.state.currentIdx];
                document.getElementById('q-current').innerText = this.state.currentIdx + 1;
                document.getElementById('q-total').innerText = this.state.queue.length;
                document.getElementById('q-text').innerText = q.text;
                document.getElementById('q-category').innerText = q.category;

                const codeEl = document.getElementById('code-content');
                if (q.code) {
                    document.getElementById('code-container').classList.remove('hidden');
                    codeEl.textContent = q.code;
                    Prism.highlightElement(codeEl);
                } else {
                    document.getElementById('code-container').classList.add('hidden');
                }

                const optsDiv = document.getElementById('options-list');
                optsDiv.innerHTML = '';
                document.getElementById('explanation-box').classList.add('hidden');

                q.options.forEach((opt, i) => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left p-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-darkcard hover:bg-indigo-50 flex items-center";
                    btn.onclick = () => this.checkAnswer(i);
                    btn.innerHTML = `<span class="w-8 h-8 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center font-bold mr-4">${String.fromCharCode(65 + i)}</span>${opt}`;
                    optsDiv.appendChild(btn);
                });
            },

            checkAnswer: function (idx) {
                const q = this.state.queue[this.state.currentIdx];
                const isCorrect = idx === q.answer;
                if (isCorrect) this.state.sessionStats.correct++;
                this.data.results[q.id] = isCorrect;
                this.save();

                document.getElementById('result-badge').innerHTML = isCorrect ? '<span class="text-emerald-500">â­• æ­£è§£ï¼</span>' : '<span class="text-red-500">âŒ ä¸æ­£è§£...</span>';
                document.getElementById('explanation-text').innerText = q.explanation;
                document.getElementById('explanation-box').classList.remove('hidden');
                document.querySelectorAll('#options-list button').forEach(b => b.disabled = true);
            },

            nextQuestion: function () {
                this.state.currentIdx++;
                if (this.state.currentIdx >= this.state.queue.length) this.finishSession();
                else this.renderQuestion();
            },

            finishSession: function () {
                const log = { date: Date.now(), correct: this.state.sessionStats.correct, total: this.state.queue.length, mode: this.data.examMode };
                this.data.history.push(log);
                this.save();
                document.getElementById('res-score').innerText = `${log.correct}/${log.total}`;
                document.getElementById('res-rate').innerText = Math.round((log.correct / log.total) * 100) + '%';
                document.getElementById('session-result').classList.remove('hidden');
            },

            closeSessionResult: function () {
                document.getElementById('session-result').classList.add('hidden');
                this.switchTab('dashboard');
            },

            updateDashboard: function () {
                document.getElementById('stat-total').innerText = this.data.questions.length;
                document.getElementById('bookmark-count').innerText = this.data.bookmarks.length;
                const wrongs = this.data.questions.filter(q => this.data.results[q.id] === false);
                document.getElementById('wrong-count').innerText = wrongs.length;
            },

            toggleTheme: function () {
                this.data.theme = this.data.theme === 'dark' ? 'light' : 'dark';
                this.applyTheme();
                this.save();
            },

            applyTheme: function () {
                if (this.data.theme === 'dark') document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }
        };

        const dataManager = {
            importData: function (input) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        app.data.questions = Array.isArray(json) ? json : json.questions;
                        app.save();
                        app.updateDashboard();
                        alert('èª­ã¿è¾¼ã¿å®Œäº†ï¼');
                    } catch (err) { alert('JSONã‚¨ãƒ©ãƒ¼ã§ã™'); }
                };
                reader.readAsText(input.files[0]);
            }
        };

        // --- Dummy creator/coding logic to avoid errors ---
        const creator = { addOption: () => { }, cancelEdit: () => { }, saveQuestion: (e) => e.preventDefault() };
        const aiTutor = { saveKey: () => { }, getAdvice: () => { } };
        const codingApp = { close: () => { }, check: () => { } };

        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>

</html>